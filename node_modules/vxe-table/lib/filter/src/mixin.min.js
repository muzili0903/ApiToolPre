"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils")),_tools=require("../../tools"),_util=require("../../table/src/util"),_vXETable=_interopRequireDefault(require("../../v-x-e-table"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var _default={methods:{_setFilter:function(e,t){e=(0,_util.handleFieldOrColumn)(this,e);return e&&e.filters&&t&&(e.filters=_tools.UtilTools.getFilters(t)),this.$nextTick()},checkFilterOptions:function(){var e=this.filterStore;e.isAllSelected=e.options.every(function(e){return e._checked}),e.isIndeterminate=!e.isAllSelected&&e.options.some(function(e){return e._checked})},triggerFilterEvent:function(e,n,t){var f,a,l,i,r,c,u=this,h=this.filterStore;h.column===n&&h.visible?h.visible=!1:(f=e.target,a=e.pageX,l=n.filters,i=n.filterMultiple,e=(e=n.filterRender)?_vXETable.default.renderer.get(e.name):null,r=n.filterRecoverMethod||(e?e.filterRecoverMethod:null),c=_tools.DomTools.getDomNode().visibleWidth,Object.assign(h,{args:t,multiple:i,options:l,column:n,style:null,visible:!0}),h.options.forEach(function(e){var t=e._checked,l=e.checked;(e._checked=l)||t===l||r&&r({option:e,column:n,$table:u})}),this.checkFilterOptions(),this.initStore.filter=!0,this.$nextTick(function(){var e,t,l=u.$refs,i=l.tableBody.$el,r=l.filterWrapper.$el.offsetWidth,o=r/2,s=i.clientWidth-r-10,l={top:"".concat(f.offsetTop+f.offsetParent.offsetTop+f.offsetHeight+8,"px")};"left"===n.fixed?e=f.offsetLeft+f.offsetParent.offsetLeft-o:"right"===n.fixed?t=f.offsetParent.offsetWidth-f.offsetLeft+(f.offsetParent.offsetParent.offsetWidth-f.offsetParent.offsetLeft)-n.renderWidth-o:e=f.offsetLeft+f.offsetParent.offsetLeft-o-i.scrollLeft,e?(0<(i=a+r-o+10-c)&&(e-=i),l.left="".concat(Math.min(s,Math.max(10,e)),"px")):t&&(0<(o=a+r-o+10-c)&&(t+=o),l.right="".concat(Math.max(10,t),"px")),h.style=l}))},_getCheckedFilters:function(){var e=this.tableFullColumn,o=[];return e.filter(function(e){var t=e.property,l=e.filters,i=[],r=[];l&&l.length&&(l.forEach(function(e){e.checked&&(i.push(e.value),r.push(e.data))}),i.length&&o.push({column:e,property:t,values:i,datas:r}))}),o},confirmFilterEvent:function(e){var t=this,l=this.filterStore,i=this.filterOpts,r=this.scrollXLoad,o=this.scrollYLoad,s=l.column,n=s.property,f=[],a=[];s.filters.forEach(function(e){e.checked&&(f.push(e.value),a.push(e.data))}),l.visible=!1;l=this.getCheckedFilters();i.remote||(this.handleTableData(!0),this.checkSelectionStatus()),this.emitEvent("filter-change",{column:s,property:n,values:f,datas:a,filters:l,filterList:l},e),this.updateFooter(),(r||o)&&(this.clearScroll(),o&&this.updateScrollYSpace()),this.closeFilter(),this.$nextTick(function(){t.recalculate(),t.updateCellAreas()})},handleClearFilter:function(e){var t,l,i;e&&(t=e.filters,l=e.filterRender,t&&(l=l?_vXETable.default.renderer.get(l.name):null,i=e.filterResetMethod||(l?l.filterResetMethod:null),t.forEach(function(e){e._checked=!1,e.checked=!1,i||(e.data=_xeUtils.default.clone(e.resetValue,!0))}),i&&i({options:t,column:e,$table:this})))},resetFilterEvent:function(e){this.handleClearFilter(this.filterStore.column),this.confirmFilterEvent(e)},_clearFilter:function(e){var t,l=this.filterStore;return e?(t=(0,_util.handleFieldOrColumn)(this,e))&&this.handleClearFilter(t):this.visibleColumn.forEach(this.handleClearFilter),e&&t===l.column||Object.assign(l,{isAllSelected:!1,isIndeterminate:!1,style:null,options:[],column:null,multiple:!1,visible:!1}),this.updateData()}}};exports.default=_default;