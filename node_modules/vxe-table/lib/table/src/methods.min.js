"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils")),_conf=_interopRequireDefault(require("../../v-x-e-table/src/conf")),_cell=_interopRequireDefault(require("./cell")),_vXETable=_interopRequireDefault(require("../../v-x-e-table")),_tools=require("../../tools"),_util=require("./util"),_dom=require("../../tools/src/dom"),_formats=require("../../v-x-e-table/src/formats");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(r="Object"===r&&e.constructor?e.constructor.name:r)||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,o=new Array(t);r<t;r++)o[r]=e[r];return o}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var getRowid=_tools.UtilTools.getRowid,getRowkey=_tools.UtilTools.getRowkey,setCellValue=_tools.UtilTools.setCellValue,hasChildrenList=_tools.UtilTools.hasChildrenList,getColumnList=_tools.UtilTools.getColumnList,calcHeight=_tools.DomTools.calcHeight,hasClass=_tools.DomTools.hasClass,addClass=_tools.DomTools.addClass,removeClass=_tools.DomTools.removeClass,getEventTargetNode=_tools.DomTools.getEventTargetNode,isWebkit=_dom.browse["-webkit"]&&!_dom.browse.edge,debounceScrollYDuration=_dom.browse.msie?80:20,resizableStorageKey="VXE_TABLE_CUSTOM_COLUMN_WIDTH",visibleStorageKey="VXE_TABLE_CUSTOM_COLUMN_VISIBLE";function getRowUniqueId(){return _xeUtils.default.uniqueId("row_")}function eqCellValue(e,t,r){e=_xeUtils.default.get(e,r),r=_xeUtils.default.get(t,r);return!(!(0,_util.eqCellNull)(e)||!(0,_util.eqCellNull)(r))||(_xeUtils.default.isString(e)||_xeUtils.default.isNumber(e)?e==r:_xeUtils.default.isEqual(e,r))}function getNextSortOrder(e,t){e=e.sortOpts.orders,t=t.order||null,t=e.indexOf(t)+1;return e[t<e.length?t:0]}function getCustomStorageMap(e){var t=_conf.default.version,e=_xeUtils.default.toStringJSON(localStorage.getItem(e));return e&&e._v===t?e:{_v:t}}function getRecoverRow(e,t){var r=e.fullAllDataRowMap;return t.filter(function(e){return r.has(e)})}function handleReserveRow(e,t){var r=e.fullDataRowIdData,o=[];return _xeUtils.default.each(t,function(e,t){r[t]&&-1===o.indexOf(r[t].row)&&o.push(r[t].row)}),o}function restoreScroll(e,t,r){return e.clearScroll().then(function(){if(t||r)return e.lastScrollLeft=0,e.lastScrollTop=0,e.scrollTo(t,r)})}function computeVirtualX(e){var t=e.$refs,r=e.visibleColumn,t=t.tableBody,t=t?t.$el:null;if(t){for(var o=t.scrollLeft,i=o+t.clientWidth,l=-1,n=0,s=0,a=0,c=r.length;a<c&&(n+=r[a].renderWidth,!(0<=(l=-1===l&&o<n?a:l)&&(s++,i<n)));a++);return{toVisibleIndex:Math.max(0,l),visibleSize:Math.max(8,s)}}return{toVisibleIndex:0,visibleSize:8}}function computeVirtualY(e){var t=e.$refs,r=e.vSize,o=e.rowHeightMaps,i=t.tableHeader,l=t.tableBody,e=l?l.$el:null;if(e){t=i?i.$el:null,l=0,i=e.querySelector("tr");return{rowHeight:l=(l=(i=!i&&t?t.querySelector("tr"):i)?i.clientHeight:l)||o[r||"default"],visibleSize:Math.max(8,Math.ceil(e.clientHeight/l)+2)}}return{rowHeight:0,visibleSize:8}}function calculateMergerOffserIndex(e,t,r){for(var o=0,i=e.length;o<i;o++){var l=e[o],n=t.startIndex,s=t.endIndex,a=l[r],l=a+l[r+"span"];a<n&&n<l&&(t.startIndex=a),a<s&&s<l&&(t.endIndex=l),t.startIndex===n&&t.endIndex===s||(o=-1)}}function setMerges(e,t,n,s){if(t){var r=e.treeConfig,a=e.visibleColumn;if(r)throw new Error(_tools.UtilTools.getLog("vxe.error.noTree",["merge-footer-items"]));(t=!_xeUtils.default.isArray(t)?[t]:t).forEach(function(e){var t,r=e.row,o=e.col,i=e.rowspan,l=e.colspan;s&&_xeUtils.default.isNumber(r)&&(r=s[r]),_xeUtils.default.isNumber(o)&&(o=a[o]),(s?r:_xeUtils.default.isNumber(r))&&o&&(i||l)&&(i=_xeUtils.default.toNumber(i)||1,l=_xeUtils.default.toNumber(l)||1,(1<i||1<l)&&(t=_xeUtils.default.findIndexOf(n,function(e){return e._row===r&&e._col===o}),(e=n[t])?(e.rowspan=i,e.colspan=l,e._rowspan=i,e._colspan=l):(t=s?s.indexOf(r):r,e=a.indexOf(o),n.push({row:t,col:e,rowspan:i,colspan:l,_row:r,_col:o,_rowspan:i,_colspan:l}))))})}}function removeMerges(e,t,o,i){var l=[];if(t){var r=e.treeConfig,n=e.visibleColumn;if(r)throw new Error(_tools.UtilTools.getLog("vxe.error.noTree",["merge-cells"]));(t=!_xeUtils.default.isArray(t)?[t]:t).forEach(function(e){var t=e.row,r=e.col;i&&_xeUtils.default.isNumber(t)&&(t=i[t]),_xeUtils.default.isNumber(r)&&(r=n[r]);e=_xeUtils.default.findIndexOf(o,function(e){return e._row===t&&e._col===r});-1<e&&(e=o.splice(e,1),l.push(e[0]))})}return l}function clearAllSort(e){e.tableFullColumn.forEach(function(e){e.order=null})}function getOrderField(t,r){var o=r.sortBy,i=r.sortType;return function(e){e=o?_xeUtils.default.isFunction(o)?o({row:e,column:r}):_xeUtils.default.get(e,o):t.getCellLabel(e,r);return i&&"auto"!==i?"number"===i?_xeUtils.default.toNumber(e):"string"===i?_xeUtils.default.toValueString(e):e:isNaN(e)?e:_xeUtils.default.toNumber(e)}}var Methods={callSlot:function(e,t,r,o){if(e){var i=this.$xegrid;if(i)return i.callSlot(e,t,r,o);if(_xeUtils.default.isFunction(e))return e.call(this,t,r,o)}return[]},getParentElem:function(){var e=this.$el,t=this.$xegrid;return(t?t.$el:e).parentNode},getParentHeight:function(){var e=this.$el,t=this.$xegrid,r=this.height,e=e.parentNode,r="auto"===r?(0,_dom.getPaddingTopBottomSize)(e):0;return Math.floor(t?t.getParentHeight():_xeUtils.default.toNumber(getComputedStyle(e).height)-r)},getExcludeHeight:function(){var e=this.$xegrid;return e?e.getExcludeHeight():0},clearAll:function(){return(0,_util.clearTableAllStatus)(this)},syncData:function(){var e=this;return this.$nextTick().then(function(){return e.tableData=[],e.$nextTick().then(function(){return e.loadTableData(e.tableFullData)})})},updateData:function(){return this.handleTableData(!0).then(this.updateFooter).then(this.recalculate)},handleTableData:function(e){var t=this.scrollYLoad,r=this.scrollYStore,e=e?this.updateAfterFullData():this.afterFullData;return this.tableData=t?e.slice(r.startIndex,r.endIndex):e.slice(0),this.$nextTick()},loadTableData:function(e){var t=this,r=this.keepSource,o=this.treeConfig,i=this.editStore,l=this.sYOpts,n=this.scrollYStore,s=this.scrollXStore,a=this.lastScrollLeft,c=this.lastScrollTop,u=e?e.slice(0):[],h=!o&&l.enabled&&-1<l.gt&&l.gt<u.length;return n.startIndex=0,n.endIndex=1,s.startIndex=0,s.endIndex=1,i.insertList=[],i.removeList=[],this.tableFullData=u,this.updateCache(!0),this.tableSynchData=e,r&&(this.tableSourceData=_xeUtils.default.clone(u,!0)),this.scrollYLoad=h,"development"===process.env.NODE_ENV&&h&&(this.height||this.maxHeight||_tools.UtilTools.error("vxe.error.reqProp",["table.height | table.max-height | table.scroll-y={enabled: false}"]),this.showOverflow||_tools.UtilTools.warn("vxe.error.reqProp",["table.show-overflow"]),this.spanMethod&&_tools.UtilTools.warn("vxe.error.scrollErrProp",["table.span-method"])),this.clearCellAreas&&this.mouseConfig&&(this.clearCellAreas(),this.clearCopyCellArea()),this.clearMergeCells(),this.clearMergeFooterItems(),this.handleTableData(!0),this.updateFooter(),this.$nextTick().then(function(){t.updateHeight(),t.updateStyle()}).then(function(){t.computeScrollLoad()}).then(function(){return h&&(n.endIndex=n.visibleSize),t.handleReserveStatus(),t.checkSelectionStatus(),t.$nextTick().then(function(){return t.recalculate()}).then(function(){return restoreScroll(t,a,c)})})},loadData:function(e){var t=this,r=this.inited,o=this.initStatus;return this.loadTableData(e).then(function(){return t.inited=!0,t.initStatus=!0,o||t.handleLoadDefaults(),r||t.handleInitDefaults(),t.recalculate()})},reloadData:function(e){var t=this,r=this.inited;return this.clearAll().then(function(){return t.inited=!0,t.initStatus=!0,t.loadTableData(e)}).then(function(){return t.handleLoadDefaults(),r||t.handleInitDefaults(),t.recalculate()})},reloadRow:function(e,t,r){var o,i=this.keepSource,l=this.tableSourceData,n=this.tableData;return i?((i=l[o=this.getRowIndex(e)])&&e&&(r?_xeUtils.default.set(i,r,_xeUtils.default.get(t||e,r)):t?(l[o]=t,_xeUtils.default.clear(e,void 0),Object.assign(e,this.defineField(Object.assign({},t))),this.updateCache(!0)):_xeUtils.default.destructuring(i,_xeUtils.default.clone(e,!0))),this.tableData=n.slice(0)):"development"===process.env.NODE_ENV&&_tools.UtilTools.warn("vxe.error.reqProp",["keep-source"]),this.$nextTick()},loadColumn:function(e){var t=this,e=_xeUtils.default.mapTree(e,function(e){return _cell.default.createColumn(t,e)},{children:"children"});return this.handleColumn(e),this.$nextTick()},reloadColumn:function(e){var t=this;return this.clearAll().then(function(){return t.loadColumn(e)})},handleColumn:function(e){var t=this;this.collectColumn=e;var r=getColumnList(e);this.tableFullColumn=r,this.cacheColumnMap(),this.restoreCustomStorage(),this.parseColumns().then(function(){t.scrollXLoad&&t.loadScrollXData(!0)}),this.clearMergeCells(),this.clearMergeFooterItems(),this.handleTableData(!0),"development"===process.env.NODE_ENV&&(this.scrollXLoad||this.scrollYLoad)&&this.expandColumn&&_tools.UtilTools.warn("vxe.error.scrollErrProp",["column.type=expand"]),this.$nextTick(function(){t.$toolbar&&t.$toolbar.syncUpdate({collectColumn:e,$table:t})})},updateCache:function(n){function e(e,t,r,o,i){var l=getRowid(s,e);l||(l=getRowUniqueId(),_xeUtils.default.set(e,g,l)),x&&e[c.hasChild]&&_xeUtils.default.isUndefined(e[c.children])&&(e[c.children]=null),i={row:e,rowid:l,index:a&&i?-1:t,items:r,parent:i},n&&(d[l]=i,u.set(e,i)),f[l]=i,h.set(e,i)}var s=this,a=this.treeConfig,c=this.treeOpts,t=this.tableFullData,u=this.fullDataRowMap,h=this.fullAllDataRowMap,d=this.fullDataRowIdData,f=this.fullAllDataRowIdData,g=getRowkey(this),x=a&&c.lazy;n&&(d=this.fullDataRowIdData={},u.clear()),f=this.fullAllDataRowIdData={},h.clear(),a?_xeUtils.default.eachTree(t,e,c):t.forEach(e)},loadChildren:function(u,e){var h=this;return this.createData(e).then(function(e){var t,r=h.keepSource,o=h.tableSourceData,i=h.treeOpts,n=h.fullDataRowIdData,s=h.fullDataRowMap,a=h.fullAllDataRowMap,c=h.fullAllDataRowIdData,l=i.children;return r&&(t=getRowid(h,u),(o=_xeUtils.default.findTree(o,function(e){return t===getRowid(h,e)},i))&&(o.item[l]=_xeUtils.default.clone(e,!0))),_xeUtils.default.eachTree(e,function(e,t,r,o,i){var l=getRowid(h,e),i={row:e,rowid:l,index:-1,items:r,parent:i};n[l]=i,s.set(e,i),c[l]=i,a.set(e,i)},i),u[l]=e})},cacheColumnMap:function(){function n(e,t,r,o,i){var l=e.id,n=e.property,s=e.fixed,a=e.type,c=e.treeNode,i={column:e,colid:l,index:t,items:r,parent:i};n&&("development"===process.env.NODE_ENV&&m[n]&&_tools.UtilTools.error("vxe.error.colRepet",["field",n]),m[n]=i),!g&&s&&(g=s),c?("development"===process.env.NODE_ENV&&h&&_tools.UtilTools.warn("vxe.error.colRepet",["tree-node",c]),h=h||e):"expand"===a&&("development"===process.env.NODE_ENV&&u&&_tools.UtilTools.warn("vxe.error.colRepet",["type",a]),u=u||e),"development"===process.env.NODE_ENV&&("checkbox"===a?(d&&_tools.UtilTools.warn("vxe.error.colRepet",["type",a]),d=d||e):"radio"===a&&(f&&_tools.UtilTools.warn("vxe.error.colRepet",["type",a]),f=f||e)),"development"===process.env.NODE_ENV&&(x.showOverflow&&!1===e.showOverflow&&_tools.UtilTools.warn("vxe.error.errConflicts",["table.show-overflow=".concat(x.showOverflow),"column.show-overflow=".concat(e.showOverflow)]),x.showHeaderOverflow&&!1===e.showHeaderOverflow&&_tools.UtilTools.warn("vxe.error.errConflicts",["table.show-header-overflow=".concat(x.showHeaderOverflow),"column.show-header-overflow=".concat(e.showHeaderOverflow)]),x.showFooterOverflow&&!1===e.showFooterOverflow&&_tools.UtilTools.warn("vxe.error.errConflicts",["table.show-footer-overflow=".concat(x.showFooterOverflow),"column.show-footer-overflow=".concat(e.showFooterOverflow)])),w&&!1===e.showOverflow&&(w=!1),p[l]&&_tools.UtilTools.error("vxe.error.colRepet",["colId",l]),p[l]=i,v.set(e,i)}var u,h,d,f,g,x=this,e=this.tableFullColumn,t=this.collectColumn,v=this.fullColumnMap,r=this.showOverflow,p=this.fullColumnIdData={},m=this.fullColumnFieldData={},o=t.some(hasChildrenList),w=!!r;v.clear(),o?_xeUtils.default.eachTree(t,function(e,t,r,o,i,l){e.level=l.length,n(e,t,r,0,i)}):e.forEach(n),"development"===process.env.NODE_ENV&&u&&this.mouseOpts.area&&_tools.UtilTools.error("vxe.error.errConflicts",["mouse-config.area","column.type=expand"]),this.isGroup=o,this.treeNodeColumn=h,this.expandColumn=u,this.isAllOverflow=w},getRowNode:function(e){if(e){e=this.fullAllDataRowIdData[e.getAttribute("rowid")];if(e)return{rowid:e.rowid,item:e.row,index:e.index,items:e.items,parent:e.parent}}return null},getColumnNode:function(e){if(e){e=this.fullColumnIdData[e.getAttribute("colid")];if(e)return{colid:e.colid,item:e.column,index:e.index,items:e.items,parent:e.parent}}return null},getRowIndex:function(e){return this.fullDataRowMap.has(e)?this.fullDataRowMap.get(e).index:-1},getVTRowIndex:function(e){return this.afterFullData.indexOf(e)},_getRowIndex:function(e){return"development"===process.env.NODE_ENV&&_tools.UtilTools.warn("vxe.error.delFunc",["_getRowIndex","getVTRowIndex"]),this.getVTRowIndex(e)},getVMRowIndex:function(e){return this.tableData.indexOf(e)},$getRowIndex:function(e){return"development"===process.env.NODE_ENV&&_tools.UtilTools.warn("vxe.error.delFunc",["$getRowIndex","getVMRowIndex"]),this.getVMRowIndex(e)},getColumnIndex:function(e){return this.fullColumnMap.has(e)?this.fullColumnMap.get(e).index:-1},getVTColumnIndex:function(e){return this.visibleColumn.indexOf(e)},_getColumnIndex:function(e){return"development"===process.env.NODE_ENV&&_tools.UtilTools.warn("vxe.error.delFunc",["_getColumnIndex","getVTColumnIndex"]),this.getVTColumnIndex(e)},getVMColumnIndex:function(e){return this.tableColumn.indexOf(e)},$getColumnIndex:function(e){return"development"===process.env.NODE_ENV&&_tools.UtilTools.warn("vxe.error.delFunc",["$getColumnIndex","getVMColumnIndex"]),this.getVMColumnIndex(e)},isSeqColumn:function(e){return e&&"seq"===e.type},defineField:function(r){var e=this.radioOpts,t=this.checkboxOpts,o=this.treeConfig,i=this.treeOpts,l=this.expandOpts,n=getRowkey(this);return this.visibleColumn.forEach(function(e){var t=e.property,e=e.editRender;t&&!_xeUtils.default.has(r,t)&&_xeUtils.default.set(r,t,e&&!_xeUtils.default.isUndefined(e.defaultValue)?e.defaultValue:null)}),[e.labelField,t.checkField,t.labelField,l.labelField].forEach(function(e){e&&!_xeUtils.default.get(r,e)&&_xeUtils.default.set(r,e,null)}),o&&i.lazy&&_xeUtils.default.isUndefined(r[i.children])&&(r[i.children]=null),_xeUtils.default.get(r,n)||_xeUtils.default.set(r,n,getRowUniqueId()),r},createData:function(e){function t(e){return r.defineField(Object.assign({},e))}var r=this,o=this.treeConfig,i=this.treeOpts,l=o?_xeUtils.default.mapTree(e,t,i):e.map(t);return this.$nextTick().then(function(){return l})},createRow:function(e){var t=this,r=_xeUtils.default.isArray(e);return r||(e=[e]),this.$nextTick().then(function(){return t.createData(e).then(function(e){return r?e:e[0]})})},revertData:function(e,r){var o=this,t=this.keepSource,i=this.tableSourceData,l=this.treeConfig;return t?arguments.length?((e=e&&!_xeUtils.default.isArray(e)?[e]:e).forEach(function(e){if(!o.isInsertByRow(e)){var t=o.getRowIndex(e);if(l&&-1===t)throw new Error(_tools.UtilTools.getLog("vxe.error.noTree",["revertData"]));t=i[t];t&&e&&(r?_xeUtils.default.set(e,r,_xeUtils.default.clone(_xeUtils.default.get(t,r),!0)):_xeUtils.default.destructuring(e,_xeUtils.default.clone(t,!0)))}}),this.$nextTick()):this.reloadData(i):("development"===process.env.NODE_ENV&&_tools.UtilTools.warn("vxe.error.reqProp",["keep-source"]),this.$nextTick())},clearData:function(e,t){var r=this.tableFullData,o=this.visibleColumn;return arguments.length?e&&!_xeUtils.default.isArray(e)&&(e=[e]):e=r,t?e.forEach(function(e){return _xeUtils.default.set(e,t,null)}):e.forEach(function(t){o.forEach(function(e){e.property&&setCellValue(t,e,null)})}),this.$nextTick()},isInsertByRow:function(e){return-1<this.editStore.insertList.indexOf(e)},isUpdateByRow:function(e,t){var r=this,o=this.visibleColumn,i=this.keepSource,l=this.treeConfig,n=this.treeOpts,s=this.tableSourceData,a=this.fullDataRowIdData;if(i){var c,u,h=getRowid(this,e);if(!a[h])return!1;if(l?(l=n.children,n=_xeUtils.default.findTree(s,function(e){return h===getRowid(r,e)},n),e=Object.assign({},e,_defineProperty({},l,null)),n&&(u=Object.assign({},n.item,_defineProperty({},l,null)))):u=s[a[h].index],u){if(1<arguments.length)return!eqCellValue(u,e,t);for(var d=0,f=o.length;d<f;d++)if((c=o[d].property)&&!eqCellValue(u,e,c))return!0}}return!1},getColumns:function(e){var t=this.visibleColumn;return _xeUtils.default.isUndefined(e)?t.slice(0):t[e]},getColumnById:function(e){var t=this.fullColumnIdData;return t[e]?t[e].column:null},getColumnByField:function(e){var t=this.fullColumnFieldData;return t[e]?t[e].column:null},getTableColumn:function(){return{collectColumn:this.collectColumn.slice(0),fullColumn:this.tableFullColumn.slice(0),visibleColumn:this.visibleColumn.slice(0),tableColumn:this.tableColumn.slice(0)}},getData:function(e){var t=this.data||this.tableSynchData;return _xeUtils.default.isUndefined(e)?t.slice(0):t[e]},getCheckboxRecords:function(){var t,e=this.tableFullData,r=this.treeConfig,o=this.treeOpts,i=this.checkboxOpts.checkField;return i?r?_xeUtils.default.filterTree(e,function(e){return _xeUtils.default.get(e,i)},o):e.filter(function(e){return _xeUtils.default.get(e,i)}):(t=this.selection,r?_xeUtils.default.filterTree(e,function(e){return-1<t.indexOf(e)},o):e.filter(function(e){return-1<t.indexOf(e)}))},updateAfterFullData:function(){var a=this,e=this.tableFullColumn,t=this.tableFullData,r=this.filterOpts,o=this.sortOpts,c=r.remote,u=r.filterMethod,n=o.remote,r=o.sortMethod,o=o.multiple,t=t.slice(0),h=[],s=[];e.forEach(function(e){var t,r,o=e.sortable,i=e.order,l=e.filters;!c&&l&&l.length&&(t=[],r=[],l.forEach(function(e){e.checked&&(r.push(e),t.push(e.value))}),r.length&&h.push({column:e,valueList:t,itemList:r})),!n&&o&&i&&s.push({column:e,property:e.property,order:i})}),h.length&&(t=t.filter(function(s){return h.every(function(e){var t=e.column,r=e.valueList,o=e.itemList;if(!r.length||c)return!0;var i=t.filterMethod,e=t.filterRender,e=e?_vXETable.default.renderer.get(e.name):null,l=e&&e.renderFilter?e.filterMethod:null,n=_tools.UtilTools.getCellValue(s,t);return i?o.some(function(e){return i({value:e.value,option:e,cellValue:n,row:s,column:t,$table:a})}):l?o.some(function(e){return l({value:e.value,option:e,cellValue:n,row:s,column:t,$table:a})}):u?u({options:o,values:r,cellValue:n,row:s,column:t}):-1<r.indexOf(_xeUtils.default.get(s,t.property))})}));var i,l=s[0];return!n&&l&&(t=r?(r=r({data:t,column:l.column,property:l.property,order:l.order,sortList:s,$table:this}),_xeUtils.default.isArray(r)?r:t):o?_xeUtils.default.orderBy(t,s.map(function(e){var t=e.column,e=e.order;return[getOrderField(a,t),e]})):(_xeUtils.default.isArray(l.sortBy)&&(i=l.sortBy.map(function(e){return[e,l.order]})),_xeUtils.default.orderBy(t,i||[l].map(function(e){var t=e.column,e=e.order;return[getOrderField(a,t),e]})))),this.afterFullData=t},getRowById:function(e){var t=this.fullDataRowIdData;return t[e]?t[e].row:null},getRowid:function(e){var t=this.fullAllDataRowMap;return t.has(e)?t.get(e).rowid:null},getTableData:function(){var e=this.tableFullData,t=this.afterFullData,r=this.tableData,o=this.footerTableData;return{fullData:e.slice(0),visibleData:t.slice(0),tableData:r.slice(0),footerData:o.slice(0)}},handleLoadDefaults:function(){var e=this;this.checkboxConfig&&this.handleDefaultSelectionChecked(),this.radioConfig&&this.handleDefaultRadioChecked(),this.expandConfig&&this.handleDefaultRowExpand(),this.treeConfig&&this.handleDefaultTreeExpand(),this.mergeCells&&this.handleDefaultMergeCells(),this.mergeFooterItems&&this.handleDefaultMergeFooterItems(),this.$nextTick(function(){return setTimeout(e.recalculate)})},handleInitDefaults:function(){this.sortConfig&&this.handleDefaultSort()},hideColumn:function(e){e=(0,_util.handleFieldOrColumn)(this,e);return e&&(e.visible=!1),this.handleCustom()},showColumn:function(e){e=(0,_util.handleFieldOrColumn)(this,e);return e&&(e.visible=!0),this.handleCustom()},resetColumn:function(e){var t=this.customOpts.checkMethod,r=Object.assign({visible:!0,resizable:!0===e},e);return this.tableFullColumn.forEach(function(e){r.resizable&&(e.resizeWidth=0),t&&!t({column:e})||(e.visible=e.defaultVisible)}),r.resizable&&this.saveCustomResizable(!0),this.handleCustom()},handleCustom:function(){return this.saveCustomVisible(),this.analyColumnWidth(),this.refreshColumn()},restoreCustomStorage:function(){var r,o,e=this.id,t=this.collectColumn,i=this.customConfig,l=this.customOpts,n=l.storage,s=!0===l.storage,l=s||n&&n.resizable,n=s||n&&n.visible;i&&(l||n)&&(r={},e?(!l||(l=getCustomStorageMap(resizableStorageKey)[e])&&_xeUtils.default.each(l,function(e,t){r[t]={field:t,resizeWidth:e}}),!n||(n=getCustomStorageMap(visibleStorageKey)[e])&&(n=(e=n.split("|"))[0]?e[0].split(","):[],e=e[1]?e[1].split(","):[],n.forEach(function(e){r[e]?r[e].visible=!1:r[e]={field:e,visible:!1}}),e.forEach(function(e){r[e]?r[e].visible=!0:r[e]={field:e,visible:!0}})),o={},_xeUtils.default.eachTree(t,function(e){var t=e.getKey();t&&(o[t]=e)}),_xeUtils.default.each(r,function(e,t){var r=e.visible,e=e.resizeWidth,t=o[t];t&&(_xeUtils.default.isNumber(e)&&(t.resizeWidth=e),_xeUtils.default.isBoolean(r)&&(t.visible=r))})):_tools.UtilTools.error("vxe.error.reqProp",["id"]))},saveCustomVisible:function(){var r,o,e=this.id,t=this.collectColumn,i=this.customConfig,l=this.customOpts,n=l.checkMethod,s=l.storage,s=!0===l.storage||s&&s.visible;i&&s&&(s=getCustomStorageMap(visibleStorageKey),r=[],o=[],e?(_xeUtils.default.eachTree(t,function(e){var t;n&&!n({column:e})||(!e.visible&&e.defaultVisible?(t=e.getKey())&&r.push(t):!e.visible||e.defaultVisible||(e=e.getKey())&&o.push(e))}),s[e]=[r.join(",")].concat(o.length?[o.join(",")]:[]).join("|")||void 0,localStorage.setItem(visibleStorageKey,_xeUtils.default.toJSONString(s))):_tools.UtilTools.error("vxe.error.reqProp",["id"]))},saveCustomResizable:function(e){var r,t=this.id,o=this.collectColumn,i=this.customConfig,l=this.customOpts,n=l.storage,n=!0===l.storage||n&&n.resizable;i&&n&&(n=getCustomStorageMap(resizableStorageKey),t?(e||(r=_xeUtils.default.isPlainObject(n[t])?n[t]:{},_xeUtils.default.eachTree(o,function(e){var t;!e.resizeWidth||(t=e.getKey())&&(r[t]=e.renderWidth)})),n[t]=_xeUtils.default.isEmpty(r)?void 0:r,localStorage.setItem(resizableStorageKey,_xeUtils.default.toJSONString(n))):_tools.UtilTools.error("vxe.error.reqProp",["id"]))},refreshColumn:function(){var e=this;return this.parseColumns().then(function(){return e.refreshScroll()}).then(function(){return e.recalculate()})},parseColumns:function(){var t,r,o,e=this,n=[],s=[],a=[],i=this.collectColumn,l=this.tableFullColumn,c=this.isGroup,u=this.columnStore,h=this.sXOpts,d=this.scrollXStore;c?(t=[],r=[],o=[],_xeUtils.default.eachTree(i,function(e,t,r,o,i){var l=hasChildrenList(e);i&&i.fixed&&(e.fixed=i.fixed),i&&e.fixed!==i.fixed&&_tools.UtilTools.error("vxe.error.groupFixed"),l?e.visible=!!_xeUtils.default.findTree(e.children,function(e){return hasChildrenList(e)?null:e.visible}):e.visible&&("left"===e.fixed?n:"right"===e.fixed?a:s).push(e)}),i.forEach(function(e){e.visible&&("left"===e.fixed?t:"right"===e.fixed?o:r).push(e)}),this.tableGroupColumn=t.concat(r).concat(o)):l.forEach(function(e){e.visible&&("left"===e.fixed?n:"right"===e.fixed?a:s).push(e)});var f=n.concat(s).concat(a),l=h.enabled&&-1<h.gt&&h.gt<l.length;return this.hasFixedColumn=0<n.length||0<a.length,Object.assign(u,{leftList:n,centerList:s,rightList:a}),l&&c&&(l=!1,"development"===process.env.NODE_ENV&&_tools.UtilTools.warn("vxe.error.scrollXNotGroup")),l&&("development"===process.env.NODE_ENV&&(this.showHeader&&!this.showHeaderOverflow&&_tools.UtilTools.warn("vxe.error.reqProp",["show-header-overflow"]),this.showFooter&&!this.showFooterOverflow&&_tools.UtilTools.warn("vxe.error.reqProp",["show-footer-overflow"]),this.spanMethod&&_tools.UtilTools.warn("vxe.error.scrollErrProp",["span-method"]),this.footerSpanMethod&&_tools.UtilTools.warn("vxe.error.scrollErrProp",["footer-span-method"])),c=computeVirtualX(this).visibleSize,d.startIndex=0,d.endIndex=c,d.visibleSize=c),f.length===this.visibleColumn.length&&this.visibleColumn.every(function(e,t){return e===f[t]})||(this.clearMergeCells(),this.clearMergeFooterItems()),this.scrollXLoad=l,this.visibleColumn=f,this.handleTableColumn(),this.updateFooter().then(function(){return e.recalculate()}).then(function(){return e.updateCellAreas(),e.recalculate()})},analyColumnWidth:function(){var e=this.columnOpts,t=e.width,r=e.minWidth,o=[],i=[],l=[],n=[],s=[],a=[];this.tableFullColumn.forEach(function(e){t&&!e.width&&(e.width=t),r&&!e.minWidth&&(e.minWidth=r),e.visible&&(e.resizeWidth?o:_tools.DomTools.isPx(e.width)?i:_tools.DomTools.isScale(e.width)?n:_tools.DomTools.isPx(e.minWidth)?l:_tools.DomTools.isScale(e.minWidth)?s:a).push(e)}),Object.assign(this.columnStore,{resizeList:o,pxList:i,pxMinList:l,scaleList:n,scaleMinList:s,autoList:a})},refreshScroll:function(){var e=this.lastScrollLeft,t=this.lastScrollTop,r=this.$refs,o=r.tableBody,i=r.leftBody,l=r.rightBody,r=r.tableFooter,o=o?o.$el:null,i=i?i.$el:null,l=l?l.$el:null,r=r?r.$el:null;if(e||t)return restoreScroll(this,e,t);(0,_dom.setScrollTop)(o,t),(0,_dom.setScrollTop)(i,t),(0,_dom.setScrollTop)(l,t),(0,_dom.setScrollLeft)(r,e)},recalculate:function(e){var t=this,r=this.$refs,o=r.tableBody,i=r.tableHeader,r=r.tableFooter,l=o?o.$el:null,n=i?i.$el:null,s=r?r.$el:null;return l&&(this.autoCellWidth(n,l,s),!0===e)?this.computeScrollLoad().then(function(){return t.autoCellWidth(n,l,s),t.computeScrollLoad()}):this.computeScrollLoad()},autoCellWidth:function(e,t,r){var o=0,i=t.clientWidth-1,l=i,n=l/100,s=this.fit,a=this.columnStore,c=a.resizeList,u=a.pxMinList,h=a.pxList,d=a.scaleList,f=a.scaleMinList,a=a.autoList;if(u.forEach(function(e){var t=parseInt(e.minWidth);o+=t,e.renderWidth=t}),f.forEach(function(e){var t=Math.floor(parseInt(e.minWidth)*n);o+=t,e.renderWidth=t}),d.forEach(function(e){var t=Math.floor(parseInt(e.width)*n);o+=t,e.renderWidth=t}),h.forEach(function(e){var t=parseInt(e.width);o+=t,e.renderWidth=t}),c.forEach(function(e){var t=parseInt(e.resizeWidth);o+=t,e.renderWidth=t}),n=0<(l-=o)?Math.floor(l/(f.length+u.length+a.length)):0,s?0<l&&f.concat(u).forEach(function(e){o+=n,e.renderWidth+=n}):n=40,a.forEach(function(e){var t=Math.max(n,40);e.renderWidth=t,o+=t}),s){var g=d.concat(f).concat(u).concat(a),x=g.length-1;if(0<x){var v=i-o;if(0<v){for(;0<v&&0<=x;)v--,g[x--].renderWidth++;o=i}}}u=t.offsetHeight,a=t.scrollHeight>t.clientHeight;this.scrollbarWidth=a?t.offsetWidth-t.clientWidth:0,this.overflowY=a,this.tableWidth=o,this.tableHeight=u,e?(this.headerHeight=e.clientHeight,this.$nextTick(function(){e&&t&&e.scrollLeft!==t.scrollLeft&&(e.scrollLeft=t.scrollLeft)})):this.headerHeight=0,r?(a=r.offsetHeight,this.scrollbarHeight=Math.max(a-r.clientHeight,0),this.overflowX=o>r.clientWidth,this.footerHeight=a):(this.footerHeight=0,this.scrollbarHeight=Math.max(u-t.clientHeight,0),this.overflowX=i<o),this.updateHeight(),this.parentHeight=Math.max(this.headerHeight+this.footerHeight+20,this.getParentHeight()),this.overflowX&&this.checkScrolling()},updateHeight:function(){this.customHeight=calcHeight(this,"height"),this.customMaxHeight=calcHeight(this,"maxHeight")},updateStyle:function(){var d=this,t=this.$refs,f=this.isGroup,g=this.fullColumnIdData,x=this.tableColumn,v=this.customHeight,p=this.customMaxHeight,m=this.border,w=this.headerHeight,b=this.showFooter,C=this.showOverflow,T=this.showHeaderOverflow,R=this.showFooterOverflow,_=this.footerHeight,E=this.tableHeight,y=this.tableWidth,S=this.scrollbarHeight,k=this.scrollbarWidth,U=this.scrollXLoad,O=this.scrollYLoad,D=this.cellOffsetWidth,I=this.columnStore,$=this.elemStore,e=this.editStore,r=this.currentRow,o=this.mouseConfig,M=this.keyboardConfig,A=this.keyboardOpts,L=this.spanMethod,F=this.mergeList,N=this.mergeFooterList,V=this.footerSpanMethod,H=this.isAllOverflow,i=t.emptyPlaceholder,l=$["main-body-wrapper"];return i&&(i.style.top="".concat(w,"px"),i.style.height=l?"".concat(l.offsetHeight-S,"px"):""),0<v&&b&&(v+=S),["main","left","right"].forEach(function(a,e){var c=0<e?a:"",u=I["".concat(c,"List")],h=t["".concat(c,"Container")];["header","body","footer"].forEach(function(i){var e,t,r,o,l=$["".concat(a,"-").concat(i,"-wrapper")],n=$["".concat(a,"-").concat(i,"-table")];"header"===i?(t=y,e=!1,f||c&&(U||T)&&(e=!0),e&&(x=u),(e||U)&&(t=x.reduce(function(e,t){return e+t.renderWidth},0)),n&&(n.style.width=t?"".concat(t+k,"px"):"",_dom.browse.msie&&_xeUtils.default.arrayEach(n.querySelectorAll(".vxe-resizable"),function(e){e.style.height="".concat(e.parentNode.offsetHeight,"px")})),(t=$["".concat(a,"-").concat(i,"-repair")])&&(t.style.width="".concat(y,"px")),t=$["".concat(a,"-").concat(i,"-list")],f&&t&&_xeUtils.default.arrayEach(t.querySelectorAll(".col--group"),function(e){var t,r,o,i=d.getColumnNode(e);i&&(i=(t=i.item).showHeaderOverflow,i=_xeUtils.default.isBoolean(i)?i:T,o=r=0,(i="title"===i||(!0===i||"tooltip"===i)||"ellipsis"===i)&&_xeUtils.default.eachTree(t.children,function(e){e.children&&t.children.length||o++,r+=e.renderWidth}),e.style.width=i?"".concat(r-o-(m?2:0),"px"):"")})):"body"===i?(t=$["".concat(a,"-").concat(i,"-emptyBlock")],l&&(p?l.style.maxHeight="".concat(c?p-w-(b?0:S):p-w,"px"):l.style.height=0<v?"".concat(c?(0<v?v-w-_:E)-(b?0:S):v-w-_,"px"):""),h&&(r="right"===c,o=I["".concat(c,"List")],l&&(l.style.top="".concat(w,"px")),h.style.height="".concat((0<v?v-w-_:E)+w+_-S*(b?2:1),"px"),h.style.width="".concat(o.reduce(function(e,t){return e+t.renderWidth},r?k:0),"px")),o=y,r=!1,c&&(F.length||L||M&&A.isMerge||!(U||O||C&&H)||(r=!0)),r&&(x=u),(r||U)&&(o=x.reduce(function(e,t){return e+t.renderWidth},0)),n&&(n.style.width=o?"".concat(o,"px"):"",n.style.paddingRight=k&&c&&(_dom.browse["-moz"]||_dom.browse.safari)?"".concat(k,"px"):""),t&&(t.style.width=o?"".concat(o,"px"):"")):"footer"===i&&(s=y,o=!1,c&&(N.length&&V||!U&&!R||(o=!0)),o&&(x=u),(o||U)&&(s=x.reduce(function(e,t){return e+t.renderWidth},0)),l&&(h&&(l.style.top="".concat(0<v?v-_:E+w,"px")),l.style.marginTop="".concat(-S,"px")),n&&(n.style.width=s?"".concat(s+k,"px"):""));var s=$["".concat(a,"-").concat(i,"-colgroup")];s&&_xeUtils.default.arrayEach(s.children,function(e){var n,t,r,s,o=e.getAttribute("name");"col_gutter"===o&&(e.style.width="".concat(k,"px")),g[o]&&(t=(n=g[o].column).showHeaderOverflow,r=n.showFooterOverflow,o=n.showOverflow,e.style.width="".concat(n.renderWidth,"px"),s="title"===(o="header"===i?_xeUtils.default.isUndefined(t)||_xeUtils.default.isNull(t)?T:t:"footer"===i?_xeUtils.default.isUndefined(r)||_xeUtils.default.isNull(r)?R:r:_xeUtils.default.isUndefined(o)||_xeUtils.default.isNull(o)?C:o)||(!0===o||"tooltip"===o)||"ellipsis"===o,o=$["".concat(a,"-").concat(i,"-list")],"header"===i||"footer"===i?U&&!s&&(s=!0):!U&&!O||s||(s=!0),o&&_xeUtils.default.arrayEach(o.querySelectorAll(".".concat(n.id)),function(e){var t=parseInt(e.getAttribute("colspan")||1),e=e.querySelector(".vxe-cell"),r=n.renderWidth;if(e){if(1<t)for(var o=d.getColumnIndex(n),i=1;i<t;i++){var l=d.getColumns(o+i);l&&(r+=l.renderWidth)}e.style.width=s?"".concat(r-D*t,"px"):""}}))})})}),r&&this.setCurrentRow(r),o&&o.selected&&e.selected.row&&e.selected.column&&this.addColSdCls(),this.$nextTick()},checkScrolling:function(){var e=this.$refs,t=e.tableBody,r=e.leftContainer,e=e.rightContainer,t=t?t.$el:null;t&&(r&&_tools.DomTools[0<t.scrollLeft?"addClass":"removeClass"](r,"scrolling--middle"),e&&_tools.DomTools[t.clientWidth<t.scrollWidth-Math.ceil(t.scrollLeft)?"addClass":"removeClass"](e,"scrolling--middle"))},preventEvent:function(t,e,r,o,i){var l,n=this;return _vXETable.default.interceptor.get(e).some(function(e){return!1===e(Object.assign({$grid:n.$xegrid,$table:n,$event:t},r))})||o&&(l=o()),i&&i(),l},handleGlobalMousedownEvent:function(r){var o=this,i=this.$el,e=this.$refs,t=this.$xegrid,l=this.$toolbar,n=this.mouseConfig,s=this.editStore,a=this.ctxMenuStore,c=this.editOpts,u=this.filterStore,h=this.getRowNode,d=s.actived,f=e.ctxWrapper,s=e.filterWrapper,e=e.validTip;s&&(getEventTargetNode(r,i,"vxe-cell--filter").flag||getEventTargetNode(r,s.$el).flag||getEventTargetNode(r,document.body,"vxe-table--ignore-clear").flag||this.preventEvent(r,"event.clearFilter",u.args,this.closeFilter)),d.row?!1!==c.autoClear&&((u=d.args.cell)&&getEventTargetNode(r,u).flag||e&&getEventTargetNode(r,e.$el).flag||(!this.lastCallTime||this.lastCallTime+50<Date.now())&&(getEventTargetNode(r,document.body,"vxe-table--ignore-clear").flag||this.preventEvent(r,"event.clearActived",d.args,function(){var e,t;(e=(e=(e="row"===c.mode?!!(t=getEventTargetNode(r,i,"vxe-body--row")).flag&&h(t.targetElem).item!==d.args.row:!getEventTargetNode(r,i,"col--edit").flag)||getEventTargetNode(r,i,"vxe-header--row").flag)||getEventTargetNode(r,i,"vxe-footer--row").flag)||!o.height||o.overflowY||(t=r.target,hasClass(t,"vxe-table--body-wrapper")&&(e=r.offsetY<t.clientHeight)),!e&&getEventTargetNode(r,i).flag||setTimeout(function(){return o.clearActived(r)})}))):n&&(getEventTargetNode(r,i).flag||t&&getEventTargetNode(r,t.$el).flag||f&&getEventTargetNode(r,f.$el).flag||l&&getEventTargetNode(r,l.$el).flag||(this.clearSelected(),getEventTargetNode(r,document.body,"vxe-table--ignore-areas-clear").flag||this.preventEvent(r,"event.clearAreas",{},function(){o.clearCellAreas(),o.clearCopyCellArea()}))),a.visible&&f&&!getEventTargetNode(r,f.$el).flag&&this.closeMenu(),this.isActivated=getEventTargetNode(r,(t||this).$el).flag},handleGlobalBlurEvent:function(){this.closeFilter(),this.closeMenu()},handleGlobalMousewheelEvent:function(){this.closeTooltip(),this.closeMenu()},handleGlobalKeydownEvent:function(N){var V=this;this.isActivated&&this.preventEvent(N,"event.keydown",null,function(){var e,t,r,o,i=V.filterStore,l=V.isCtxMenu,n=V.ctxMenuStore,s=V.editStore,a=V.editOpts,c=V.editConfig,u=V.mouseConfig,h=V.mouseOpts,d=V.keyboardConfig,f=V.keyboardOpts,g=V.treeConfig,x=V.treeOpts,v=V.highlightCurrentRow,p=V.currentRow,m=V.bodyCtxMenu,w=s.selected,b=s.actived,C=N.keyCode,T=8===C,R=9===C,_=13===C,E=27===C,y=32===C,S=37===C,k=38===C,U=39===C,O=40===C,D=46===C,I=113===C,$=93===C,M=N.metaKey,A=N.ctrlKey,L=N.shiftKey,F=N.altKey,s=S||k||U||O,l=l&&n.visible&&(_||y||s),c=c&&b.column&&b.row;i.visible?E&&V.closeFilter():(l?(N.preventDefault(),n.showChild&&hasChildrenList(n.selected)?V.moveCtxMenu(N,C,n,"selectChild",37,!1,n.selected.children):V.moveCtxMenu(N,C,n,"selected",39,!0,V.ctxMenuList)):d&&u&&h.area&&V.handleKeyboardEvent?V.handleKeyboardEvent(N):d&&y&&f.isChecked&&w.row&&w.column&&("checkbox"===w.column.type||"radio"===w.column.type)?(N.preventDefault(),"checkbox"===w.column.type?V.handleToggleCheckRowEvent(N,w.args):V.triggerRadioRowEvent(N,w.args)):E?(V.closeMenu(),V.closeFilter(),b.row&&(r=b.args,V.clearActived(N),u&&h.selected&&V.$nextTick(function(){return V.handleSelected(r,N)}))):I?c||w.row&&w.column&&(N.preventDefault(),V.handleActived(w.args,N)):$?(V._keyCtx=w.row&&w.column&&m.length,clearTimeout(V.keyCtxTimeout),V.keyCtxTimeout=setTimeout(function(){V._keyCtx=!1},1e3)):_&&!F&&d&&f.isEnter&&(w.row||b.row||g&&v&&p)?A?b.row&&(r=b.args,V.clearActived(N),u&&h.selected&&V.$nextTick(function(){return V.handleSelected(r,N)})):w.row||b.row?(e=(w.row?w:b).args,L?f.enterToTab?V.moveTabSelected(e,L,N):V.moveSelected(e,S,!0,U,!1,N):f.enterToTab?V.moveTabSelected(e,L,N):V.moveSelected(e,S,!1,U,!0,N)):g&&v&&p&&((e=p[x.children])&&e.length&&(N.preventDefault(),t=e[0],r={$table:V,row:t},V.setTreeExpand(p,!0).then(function(){return V.scrollToRow(t)}).then(function(){return V.triggerCurrentRowEvent(N,r)}))):s&&d&&f.isArrow?c||(w.row&&w.column?V.moveSelected(w.args,S,k,U,O,N):(k||O)&&v&&V.moveCurrentRow(k,O,N)):R&&d&&f.isTab?w.row||w.column?V.moveTabSelected(w.args,L,N):(b.row||b.column)&&V.moveTabSelected(b.args,L,N):d&&(D||(g&&v&&p?T&&f.isArrow:T))?c||(D=f.delMethod,c=f.backMethod,f.isDel&&(w.row||w.column)?(D?D({row:w.row,rowIndex:V.getRowIndex(w.row),column:w.column,columnIndex:V.getColumnIndex(w.column),$table:V}):setCellValue(w.row,w.column,null),T&&(c?c({row:w.row,rowIndex:V.getRowIndex(w.row),column:w.column,columnIndex:V.getColumnIndex(w.column),$table:V}):V.handleActived(w.args,N))):T&&f.isArrow&&g&&v&&p&&((o=_xeUtils.default.findTree(V.afterFullData,function(e){return e===p},x).parent)&&(N.preventDefault(),r={$table:V,row:o},V.setTreeExpand(o,!1).then(function(){return V.scrollToRow(o)}).then(function(){return V.triggerCurrentRowEvent(N,r)})))):d&&f.isEdit&&!A&&!M&&(y||48<=C&&C<=57||65<=C&&C<=90||96<=C&&C<=111||186<=C&&C<=192||219<=C&&C<=222)&&(f=f.editMethod,w.column&&w.row&&(0,_tools.isEnableConf)(w.column.editRender)&&(a.activeMethod&&!a.activeMethod(w.args)||(f?f({row:w.row,rowIndex:V.getRowIndex(w.row),column:w.column,columnIndex:V.getColumnIndex(w.column),$table:V}):(setCellValue(w.row,w.column,null),V.handleActived(w.args,N))))),V.emitEvent("keydown",{},N))})},handleGlobalPasteEvent:function(e){var t=this.isActivated,r=this.keyboardConfig,o=this.keyboardOpts,i=this.mouseConfig,l=this.mouseOpts,n=this.editStore,s=this.filterStore,n=n.actived;t&&!s.visible&&(n.row||n.column||r&&o.isClip&&i&&l.area&&this.handlePasteCellAreaEvent&&this.handlePasteCellAreaEvent(e),this.emitEvent("paste",{},e))},handleGlobalCopyEvent:function(e){var t=this.isActivated,r=this.keyboardConfig,o=this.keyboardOpts,i=this.mouseConfig,l=this.mouseOpts,n=this.editStore,s=this.filterStore,n=n.actived;t&&!s.visible&&(n.row||n.column||r&&o.isClip&&i&&l.area&&this.handleCopyCellAreaEvent&&this.handleCopyCellAreaEvent(e),this.emitEvent("copy",{},e))},handleGlobalCutEvent:function(e){var t=this.isActivated,r=this.keyboardConfig,o=this.keyboardOpts,i=this.mouseConfig,l=this.mouseOpts,n=this.editStore,s=this.filterStore,n=n.actived;t&&!s.visible&&(n.row||n.column||r&&o.isClip&&i&&l.area&&this.handleCutCellAreaEvent&&this.handleCutCellAreaEvent(e),this.emitEvent("cut",{},e))},handleGlobalResizeEvent:function(){this.closeMenu(),this.updateCellAreas(),this.recalculate(!0)},handleTooltipLeaveMethod:function(){var e=this,t=this.tooltipOpts;return setTimeout(function(){e.tooltipActive||e.closeTooltip()},t.leaveDelay),!1},handleTargetEnterEvent:function(){clearTimeout(this.tooltipTimeout),this.tooltipActive=!0,this.closeTooltip()},handleTargetLeaveEvent:function(){var t=this,e=this.tooltipOpts;this.tooltipActive=!1,e.enterable?this.tooltipTimeout=setTimeout(function(){var e=t.$refs.tooltip;e&&!e.isHover&&t.closeTooltip()},e.leaveDelay):this.closeTooltip()},triggerHeaderHelpEvent:function(e,t){var r,o=t.column.titleHelp;o.message&&(r=this.$refs,t=this.tooltipStore,r=r.tooltip,o=_tools.UtilTools.getFuncText(o.message),this.handleTargetEnterEvent(),t.visible=!0,r&&r.open(e.currentTarget,o))},triggerHeaderTooltipEvent:function(e,t){var r=this.tooltipStore,o=t.column,i=e.currentTarget;this.handleTargetEnterEvent(),r.column===o&&r.visible||this.handleTooltip(e,i,i,null,t)},triggerBodyTooltipEvent:function(e,t){var r,o,i=this.editConfig,l=this.editOpts,n=this.editStore,s=this.tooltipStore,a=n.actived,c=t.row,u=t.column,n=e.currentTarget;this.handleTargetEnterEvent(),i&&("row"===l.mode&&a.row===c||a.row===c&&a.column===u)||s.column===u&&s.row===c&&s.visible||(u.treeNode?(r=n.querySelector(".vxe-tree-cell"),"html"===u.type&&(o=n.querySelector(".vxe-cell--html"))):o=n.querySelector("html"===u.type?".vxe-cell--html":".vxe-cell--label"),this.handleTooltip(e,n,r||n.children[0],o,t))},triggerFooterTooltipEvent:function(e,t){var r=t.column,o=this.tooltipStore,i=e.currentTarget;this.handleTargetEnterEvent(),o.column===r&&o.visible||this.handleTooltip(e,i,i.querySelector(".vxe-cell--item")||i.children[0],null,t)},handleTooltip:function(e,t,r,o,i){i.cell=t;var l=this.$refs,n=this.tooltipOpts,s=this.tooltipStore,a=i.column,c=i.row,u=n.showAll,h=n.enabled,t=n.contentMethod,n=l.tooltip,l=t?t(i):null,i=t&&!_xeUtils.default.eqNull(l),t=i?l:("html"===a.type?r.innerText:r.textContent).trim(),l=r.scrollWidth>r.clientWidth;return t&&(u||h||i||l)&&(Object.assign(s,{row:c,column:a,visible:!0}),n&&n.open(!l&&o||r,_tools.UtilTools.formatText(t))),this.$nextTick()},openTooltip:function(e,t){var r=this.$refs.commTip;return r?r.open(e,t):this.$nextTick()},closeTooltip:function(){var e=this.$refs,t=this.tooltipStore,r=e.tooltip,e=e.commTip;return t.visible&&(Object.assign(t,{row:null,column:null,content:null,visible:!1}),r&&r.close()),e&&e.close(),this.$nextTick()},isAllCheckboxChecked:function(){return this.isAllSelected},isCheckboxIndeterminate:function(){return!this.isAllSelected&&this.isIndeterminate},getCheckboxIndeterminateRecords:function(){var e=this.treeConfig,t=this.treeIndeterminates;return e?t.slice(0):[]},handleDefaultSelectionChecked:function(){var t,r=this.fullDataRowIdData,e=this.checkboxOpts,o=e.checkAll,e=e.checkRowKeys;o?this.setAllCheckboxRow(!0):e&&(t=[],e.forEach(function(e){r[e]&&t.push(r[e].row)}),this.setCheckboxRow(t,!0))},setCheckboxRow:function(e,t){var r=this;return(e=e&&!_xeUtils.default.isArray(e)?[e]:e).forEach(function(e){return r.handleSelectRow({row:e},!!t)}),this.$nextTick()},isCheckedByCheckboxRow:function(e){var t=this.checkboxOpts.checkField;return t?_xeUtils.default.get(e,t):-1<this.selection.indexOf(e)},handleSelectRow:function(e,r){var o=this,i=e.row,l=this.selection,t=this.afterFullData,n=this.treeConfig,s=this.treeOpts,a=this.treeIndeterminates,c=this.checkboxOpts,u=c.checkField,e=c.checkStrictly,h=c.checkMethod;if(u)if(n&&!e){-1===r?(-1===a.indexOf(i)&&a.push(i),_xeUtils.default.set(i,u,!1)):_xeUtils.default.eachTree([i],function(t){i!==t&&h&&!h({row:t})||(_xeUtils.default.set(t,u,r),_xeUtils.default.remove(a,function(e){return e===t}),o.handleCheckboxReserveRow(i,r))},s);c=_xeUtils.default.findTree(t,function(e){return e===i},s);if(c&&c.parent){var d,f=h?c.items.filter(function(e){return h({row:e})}):c.items;return d=_xeUtils.default.find(c.items,function(e){return-1<a.indexOf(e)})?-1:(d=c.items.filter(function(e){return _xeUtils.default.get(e,u)})).filter(function(e){return-1<f.indexOf(e)}).length===f.length||!(!d.length&&-1!==r)&&-1,this.handleSelectRow({row:c.parent},d)}}else h&&!h({row:i})||(_xeUtils.default.set(i,u,r),this.handleCheckboxReserveRow(i,r));else if(n&&!e){-1===r?(-1===a.indexOf(i)&&a.push(i),_xeUtils.default.remove(l,function(e){return e===i})):_xeUtils.default.eachTree([i],function(t){i!==t&&h&&!h({row:t})||(r?l.push(t):_xeUtils.default.remove(l,function(e){return e===t}),_xeUtils.default.remove(a,function(e){return e===t}),o.handleCheckboxReserveRow(i,r))},s);s=_xeUtils.default.findTree(t,function(e){return e===i},s);if(s&&s.parent){var g,x=h?s.items.filter(function(e){return h({row:e})}):s.items;return g=_xeUtils.default.find(s.items,function(e){return-1<a.indexOf(e)})?-1:(g=s.items.filter(function(e){return-1<l.indexOf(e)})).filter(function(e){return-1<x.indexOf(e)}).length===x.length||!(!g.length&&-1!==r)&&-1,this.handleSelectRow({row:s.parent},g)}}else h&&!h({row:i})||(r?-1===l.indexOf(i)&&l.push(i):_xeUtils.default.remove(l,function(e){return e===i}),this.handleCheckboxReserveRow(i,r));this.checkSelectionStatus()},handleToggleCheckRowEvent:function(e,t){var r=this.selection,o=this.checkboxOpts.checkField,i=t.row,i=o?!_xeUtils.default.get(i,o):-1===r.indexOf(i);e?this.triggerCheckRowEvent(e,t,i):this.handleSelectRow(t,i)},triggerCheckRowEvent:function(e,t,r){var o=this.checkboxOpts.checkMethod;o&&!o({row:t.row})||(this.handleSelectRow(t,r),this.emitEvent("checkbox-change",Object.assign({records:this.getCheckboxRecords(),reserves:this.getCheckboxReserveRecords(),indeterminates:this.getCheckboxIndeterminateRecords(),checked:r},t),e))},toggleCheckboxRow:function(e){return this.handleToggleCheckRowEvent(null,{row:e}),this.$nextTick()},setAllCheckboxRow:function(t){var r=this,o=this.afterFullData,e=this.treeConfig,i=this.treeOpts,l=this.selection,n=this.checkboxReserveRowMap,s=this.checkboxOpts,a=s.checkField,c=s.reserve,u=s.checkStrictly,h=s.checkMethod,d=[],s=e?[]:l.filter(function(e){return-1===o.indexOf(e)});u?this.isAllSelected=t:(a?(u=function(e){h&&!h({row:e})||(t&&d.push(e),_xeUtils.default.set(e,a,t))},e?_xeUtils.default.eachTree(o,u,i):o.forEach(u)):e?t?_xeUtils.default.eachTree(o,function(e){h&&!h({row:e})||d.push(e)},i):h&&_xeUtils.default.eachTree(o,function(e){!h({row:e})&&-1<l.indexOf(e)&&d.push(e)},i):t?d=h?o.filter(function(e){return-1<l.indexOf(e)||h({row:e})}):o.slice(0):h&&(d=o.filter(function(e){return h({row:e})?0:-1<l.indexOf(e)})),c&&(t?d.forEach(function(e){n[getRowid(r,e)]=e}):o.forEach(function(e){return r.handleCheckboxReserveRow(e,!1)})),this.selection=a?[]:s.concat(d)),this.treeIndeterminates=[],this.checkSelectionStatus()},checkSelectionStatus:function(){var e=this.afterFullData,t=this.selection,r=this.treeIndeterminates,o=this.checkboxOpts,i=this.treeConfig,l=o.checkField,n=o.halfField,s=o.checkStrictly,a=o.checkMethod;s||(s=o=!1,s=l?(o=e.length&&e.every(a?function(e){return!a({row:e})||_xeUtils.default.get(e,l)}:function(e){return _xeUtils.default.get(e,l)}),i?n?!o&&e.some(function(e){return _xeUtils.default.get(e,l)||_xeUtils.default.get(e,n)||-1<r.indexOf(e)}):!o&&e.some(function(e){return _xeUtils.default.get(e,l)||-1<r.indexOf(e)}):n?!o&&e.some(function(e){return _xeUtils.default.get(e,l)||_xeUtils.default.get(e,n)}):!o&&e.some(function(e){return _xeUtils.default.get(e,l)})):(o=e.length&&e.every(a?function(e){return!a({row:e})||-1<t.indexOf(e)}:function(e){return-1<t.indexOf(e)}),i?!o&&e.some(function(e){return-1<r.indexOf(e)||-1<t.indexOf(e)}):!o&&e.some(function(e){return-1<t.indexOf(e)})),this.isAllSelected=o,this.isIndeterminate=s)},handleReserveStatus:function(){var e=this.expandColumn,t=this.treeOpts,r=this.treeConfig,o=this.fullDataRowIdData,i=this.fullAllDataRowMap,l=this.currentRow,n=this.selectRow,s=this.radioReserveRow,a=this.radioOpts,c=this.checkboxOpts,u=this.selection,h=this.rowExpandeds,d=this.treeExpandeds,f=this.expandOpts;n&&!i.has(n)&&(this.selectRow=null),a.reserve&&s&&(o[s=getRowid(this,s)]&&this.setRadioRow(o[s].row)),this.selection=getRecoverRow(this,u),c.reserve&&this.setCheckboxRow(handleReserveRow(this,this.checkboxReserveRowMap),!0),l&&!i.has(l)&&(this.currentRow=null),this.rowExpandeds=e?getRecoverRow(this,h):[],e&&f.reserve&&this.setRowExpand(handleReserveRow(this,this.rowExpandedReserveRowMap),!0),this.treeExpandeds=r?getRecoverRow(this,d):[],r&&t.reserve&&this.setTreeExpand(handleReserveRow(this,this.treeExpandedReserveRowMap),!0)},getRadioReserveRecord:function(){var e=this.fullDataRowIdData,t=this.radioReserveRow;return this.radioOpts.reserve&&t&&!e[getRowid(this,t)]?t:null},clearRadioReserve:function(){return this.radioReserveRow=null,this.$nextTick()},handleRadioReserveRow:function(e){this.radioOpts.reserve&&(this.radioReserveRow=e)},getCheckboxReserveRecords:function(){var r=this.fullDataRowIdData,e=this.checkboxReserveRowMap,t=this.checkboxOpts,o=[];return t.reserve&&_xeUtils.default.each(e,function(e,t){e&&!r[t]&&o.push(e)}),o},clearCheckboxReserve:function(){return this.checkboxReserveRowMap={},this.$nextTick()},handleCheckboxReserveRow:function(e,t){var r,o=this.checkboxReserveRowMap;this.checkboxOpts.reserve&&(r=getRowid(this,e),t?o[r]=e:o[r]&&delete o[r])},triggerCheckAllEvent:function(e,t){this.setAllCheckboxRow(t),this.emitEvent("checkbox-all",{records:this.getCheckboxRecords(),reserves:this.getCheckboxReserveRecords(),indeterminates:this.getCheckboxIndeterminateRecords(),checked:t},e)},toggleAllCheckboxRow:function(){return this.triggerCheckAllEvent(null,!this.isAllSelected),this.$nextTick()},clearCheckboxRow:function(){var t=this,e=this.tableFullData,r=this.treeConfig,o=this.treeOpts,i=this.checkboxOpts,l=i.checkField,i=i.reserve;return l&&(r?_xeUtils.default.eachTree(e,function(e){return _xeUtils.default.set(e,l,!1)},o):e.forEach(function(e){return _xeUtils.default.set(e,l,!1)})),i&&e.forEach(function(e){return t.handleCheckboxReserveRow(e,!1)}),this.isAllSelected=!1,this.isIndeterminate=!1,this.selection=[],this.treeIndeterminates=[],this.$nextTick()},handleDefaultRadioChecked:function(){var e=this.radioOpts,t=this.fullDataRowIdData,r=e.checkRowKey,e=e.reserve;r&&(t[r]&&this.setRadioRow(t[r].row),e&&(e=getRowkey(this),this.radioReserveRow=_defineProperty({},e,r)))},triggerRadioRowEvent:function(e,t){var r=this.selectRow!==t.row;this.setRadioRow(t.row),r&&this.emitEvent("radio-change",t,e)},triggerCurrentRowEvent:function(e,t){var r=this.currentRow!==t.row;this.setCurrentRow(t.row),r&&this.emitEvent("current-change",t,e)},setCurrentRow:function(e){var t=this.$el;return this.clearCurrentRow(),this.clearCurrentColumn(),this.currentRow=e,this.highlightCurrentRow&&t&&_xeUtils.default.arrayEach(t.querySelectorAll('[rowid="'.concat(getRowid(this,e),'"]')),function(e){return addClass(e,"row--current")}),this.$nextTick()},isCheckedByRadioRow:function(e){return this.selectRow===e},setRadioRow:function(e){var t=this.radioOpts.checkMethod;return!e||t&&!t({row:e})||(this.selectRow=e,this.handleRadioReserveRow(e)),this.$nextTick()},clearCurrentRow:function(){var e=this.$el;return this.currentRow=null,this.hoverRow=null,e&&_xeUtils.default.arrayEach(e.querySelectorAll(".row--current"),function(e){return removeClass(e,"row--current")}),this.$nextTick()},clearRadioRow:function(){return this.selectRow=null,this.$nextTick()},getCurrentRecord:function(){return this.highlightCurrentRow?this.currentRow:null},getRadioRecord:function(){return this.selectRow},triggerHoverEvent:function(e,t){t=t.row;this.setHoverRow(t)},setHoverRow:function(e){var t=this.$el,r=getRowid(this,e);this.clearHoverRow(),t&&_xeUtils.default.arrayEach(t.querySelectorAll('[rowid="'.concat(r,'"]')),function(e){return addClass(e,"row--hover")}),this.hoverRow=e},clearHoverRow:function(){var e=this.$el;e&&_xeUtils.default.arrayEach(e.querySelectorAll(".vxe-body--row.row--hover"),function(e){return removeClass(e,"row--hover")}),this.hoverRow=null},triggerHeaderCellClickEvent:function(e,t){var r=this._lastResizeTime,o=this.sortOpts,i=t.column,l=e.currentTarget,n=r&&r>Date.now()-300,s=getEventTargetNode(e,l,"vxe-cell--sort").flag,r=getEventTargetNode(e,l,"vxe-cell--filter").flag;return"cell"!==o.trigger||n||s||r||this.triggerSortEvent(e,i,getNextSortOrder(this,i)),this.emitEvent("header-cell-click",Object.assign({triggerResizable:n,triggerSort:s,triggerFilter:r,cell:l},t),e),this.highlightCurrentColumn?this.setCurrentColumn(i):this.$nextTick()},triggerHeaderCellDBLClickEvent:function(e,t){this.emitEvent("header-cell-dblclick",Object.assign({cell:e.currentTarget},t),e)},getCurrentColumn:function(){return this.highlightCurrentColumn?this.currentColumn:null},setCurrentColumn:function(e){e=(0,_util.handleFieldOrColumn)(this,e);return e&&(this.clearCurrentRow(),this.clearCurrentColumn(),this.currentColumn=e),this.$nextTick()},clearCurrentColumn:function(){return this.currentColumn=null,this.$nextTick()},checkValidate:function(e){return _vXETable.default._valid?this.triggerValidate(e):this.$nextTick()},handleChangeCell:function(e,t){var r=this;this.checkValidate("blur").catch(function(e){return e}).then(function(){r.handleActived(t,e).then(function(){return r.checkValidate("change")}).catch(function(e){return e})})},triggerCellClickEvent:function(e,t){var r=this.highlightCurrentRow,o=this.editStore,i=this.radioOpts,l=this.expandOpts,n=this.treeOpts,s=this.editConfig,a=this.editOpts,c=this.checkboxOpts,u=o.actived,h=t.row,d=t.column,f=d.type,g=d.treeNode,x="radio"===f,v="checkbox"===f,p="expand"===f,m=e.currentTarget,w=x&&getEventTargetNode(e,m,"vxe-cell--radio").flag,b=v&&getEventTargetNode(e,m,"vxe-cell--checkbox").flag,o=g&&getEventTargetNode(e,m,"vxe-tree--btn-wrapper").flag,f=p&&getEventTargetNode(e,m,"vxe-table--expanded").flag;t=Object.assign({cell:m,triggerRadio:w,triggerCheckbox:b,triggerTreeNode:o,triggerExpandNode:f},t),b||w||(!f&&("row"===l.trigger||p&&"cell"===l.trigger)&&this.triggerRowExpandEvent(e,t),("row"===n.trigger||g&&"cell"===n.trigger)&&this.triggerTreeExpandEvent(e,t)),o||(f||(r&&(b||w||this.triggerCurrentRowEvent(e,t)),!w&&("row"===i.trigger||x&&"cell"===i.trigger)&&this.triggerRadioRowEvent(e,t),!b&&("row"===c.trigger||v&&"cell"===c.trigger)&&this.handleToggleCheckRowEvent(e,t)),s&&("manual"===a.trigger?u.args&&u.row===h&&d!==u.column&&this.handleChangeCell(e,t):u.args&&h===u.row&&d===u.column||("click"===a.trigger||"dblclick"===a.trigger&&"row"===a.mode&&u.row===h)&&this.handleChangeCell(e,t))),this.emitEvent("cell-click",t,e)},triggerCellDBLClickEvent:function(e,t){var r=this,o=this.editStore,i=this.editConfig,l=this.editOpts,n=o.actived,o=e.currentTarget;t.cell=o,i&&"dblclick"===l.trigger&&(n.args&&e.currentTarget===n.args.cell||("row"===l.mode?this.checkValidate("blur").catch(function(e){return e}).then(function(){r.handleActived(t,e).then(function(){return r.checkValidate("change")}).catch(function(e){return e})}):"cell"===l.mode&&this.handleActived(t,e).then(function(){return r.checkValidate("change")}).catch(function(e){return e}))),this.emitEvent("cell-dblclick",t,e)},handleDefaultSort:function(){var r=this,e=this.sortConfig,t=this.sortOpts,o=t.defaultSort;o&&(o=!_xeUtils.default.isArray(o)?[o]:o).length&&((e.multiple?o:o.slice(0,1)).forEach(function(e){var t=e.field,e=e.order;t&&e&&((t=r.getColumnByField(t))&&t.sortable&&(t.order=e,t.sortTime=Date.now()))}),t.remote||this.handleTableData(!0).then(this.updateStyle))},triggerSortEvent:function(e,t,r){var o=this.sortOpts,i=t.property;(t.sortable||t.remoteSort)&&(r&&t.order!==r?this.sort({field:i,order:r}):this.clearSort(o.multiple?t:null),t={column:t,property:i,order:t.order,sortList:this.getSortColumns()},this.emitEvent("sort-change",t,e))},sort:function(e,t){var o,i=this,r=this.sortOpts,l=r.multiple,n=r.remote,s=r.orders;return e&&_xeUtils.default.isString(e)&&(e=[{field:e,order:t}]),(e=!_xeUtils.default.isArray(e)?[e]:e).length?(l||clearAllSort(this),(l?e:[e[0]]).forEach(function(e){var t=e.field,r=e.order,e=t;(e=_xeUtils.default.isString(t)?i.getColumnByField(t):e)&&(e.sortable||e.remoteSort)&&(o=o||e,-1===s.indexOf(r)&&(r=getNextSortOrder(i,e)),e.order!==r&&(e.order=r))}),(!n||o&&o.remoteSort)&&this.handleTableData(!0),this.$nextTick().then(this.updateStyle)):this.$nextTick()},clearSort:function(e){var t=this.sortOpts;return e?(e=(0,_util.handleFieldOrColumn)(this,e))&&(e.order=null):clearAllSort(this),t.remote?this.$nextTick():this.handleTableData(!0)},getSortColumn:function(){return"development"===process.env.NODE_ENV&&_tools.UtilTools.warn("vxe.error.delFunc",["getSortColumn","getSortColumns"]),_xeUtils.default.find(this.tableFullColumn,function(e){return(e.sortable||e.remoteSort)&&e.order})},isSort:function(e){if(e){e=(0,_util.handleFieldOrColumn)(this,e);return e&&e.sortable&&!!e.order}return 0<this.getSortColumns().length},getSortColumns:function(){var r=[];return this.tableFullColumn.forEach(function(e){var t=e.order;(e.sortable||e.remoteSort)&&t&&r.push({column:e,property:e.property,order:t})}),r},closeFilter:function(){return Object.assign(this.filterStore,{isAllSelected:!1,isIndeterminate:!1,options:[],visible:!1}),this.$nextTick()},isFilter:function(e){e=(0,_util.handleFieldOrColumn)(this,e);return e?e.filters&&e.filters.some(function(e){return e.checked}):0<this.getCheckedFilters().length},isRowExpandLoaded:function(e){e=this.fullAllDataRowMap.get(e);return e&&e.expandLoaded},clearRowExpandLoaded:function(t){var e=this.expandOpts,r=this.expandLazyLoadeds,o=this.fullAllDataRowMap,e=e.lazy,o=o.get(t);return e&&o&&(o.expandLoaded=!1,_xeUtils.default.remove(r,function(e){return t===e})),this.$nextTick()},reloadExpandContent:function(e){var t=this,r=this.expandOpts,o=this.expandLazyLoadeds;return r.lazy&&-1===o.indexOf(e)&&this.clearRowExpandLoaded(e).then(function(){return t.handleAsyncRowExpand(e)}),this.$nextTick()},triggerRowExpandEvent:function(e,t){var r=this.expandOpts,o=this.expandLazyLoadeds,i=this.expandColumn,l=t.row;r.lazy&&-1!==o.indexOf(l)||(t=!this.isExpandByRow(l),r=this.getColumnIndex(i),o=this.getVMColumnIndex(i),this.setRowExpand(l,t),this.emitEvent("toggle-row-expand",{expanded:t,column:i,columnIndex:r,$columnIndex:o,row:l,rowIndex:this.getRowIndex(l),$rowIndex:this.getVMRowIndex(l)},e))},toggleRowExpand:function(e){return this.setRowExpand(e,!this.isExpandByRow(e))},handleDefaultRowExpand:function(){var t,e=this.expandOpts,r=this.fullDataRowIdData,o=e.expandAll,e=e.expandRowKeys;o?this.setAllRowExpand(!0):e&&(t=[],e.forEach(function(e){r[e]&&t.push(r[e].row)}),this.setRowExpand(t,!0))},setAllRowExpand:function(e){return this.setRowExpand(this.expandOpts.lazy?this.tableData:this.tableFullData,e)},handleAsyncRowExpand:function(t){var r=this,o=this.fullAllDataRowMap.get(t);return new Promise(function(e){r.expandLazyLoadeds.push(t),r.expandOpts.loadMethod({$table:r,row:t,rowIndex:r.getRowIndex(t),$rowIndex:r.getVMRowIndex(t)}).catch(function(e){return e}).then(function(){o.expandLoaded=!0,_xeUtils.default.remove(r.expandLazyLoadeds,function(e){return e===t}),r.rowExpandeds.push(t),e(r.$nextTick().then(r.recalculate))})})},setRowExpand:function(e,t){var r,o=this,i=this.fullAllDataRowMap,l=this.expandLazyLoadeds,n=this.expandOpts,s=this.expandColumn,a=this.rowExpandeds,c=n.reserve,u=n.lazy,h=n.accordion,d=n.toggleMethod,f=[],g=this.getColumnIndex(s),x=this.getVMColumnIndex(s);return e&&(_xeUtils.default.isArray(e)||(e=[e]),h&&(a=[],e=e.slice(e.length-1,e.length)),r=d?e.filter(function(e){return d({expanded:t,column:s,columnIndex:g,$columnIndex:x,row:e,rowIndex:o.getRowIndex(e),$rowIndex:o.getVMRowIndex(e)})}):e,t?r.forEach(function(e){var t;-1===a.indexOf(e)&&(t=i.get(e),u&&!t.expandLoaded&&-1===l.indexOf(e)?f.push(o.handleAsyncRowExpand(e)):a.push(e))}):_xeUtils.default.remove(a,function(e){return-1<r.indexOf(e)}),c&&r.forEach(function(e){return o.handleRowExpandReserve(e,t)})),this.rowExpandeds=a,Promise.all(f).then(this.recalculate)},isExpandByRow:function(e){return-1<this.rowExpandeds.indexOf(e)},clearRowExpand:function(){var t=this,e=this.expandOpts,r=this.rowExpandeds,o=this.tableFullData,e=e.reserve,i=r.length;return this.rowExpandeds=[],e&&o.forEach(function(e){return t.handleRowExpandReserve(e,!1)}),this.$nextTick().then(function(){i&&t.recalculate()})},clearRowExpandReserve:function(){return this.rowExpandedReserveRowMap={},this.$nextTick()},handleRowExpandReserve:function(e,t){var r,o=this.rowExpandedReserveRowMap;this.expandOpts.reserve&&(r=getRowid(this,e),t?o[r]=e:o[r]&&delete o[r])},getRowExpandRecords:function(){return this.rowExpandeds.slice(0)},getTreeExpandRecords:function(){return this.treeExpandeds.slice(0)},getTreeStatus:function(){return this.treeConfig?{config:this.treeOpts,rowExpandeds:this.getTreeExpandRecords()}:null},isTreeExpandLoaded:function(e){e=this.fullAllDataRowMap.get(e);return e&&e.treeLoaded},clearTreeExpandLoaded:function(t){var e=this.treeOpts,r=this.treeExpandeds,o=this.fullAllDataRowMap,e=e.lazy,o=o.get(t);return e&&o&&(o.treeLoaded=!1,_xeUtils.default.remove(r,function(e){return t===e})),this.$nextTick()},reloadTreeChilds:function(e){var t=this,r=this.treeOpts,o=this.treeLazyLoadeds,i=r.lazy,r=r.hasChild;return i&&e[r]&&-1===o.indexOf(e)&&this.clearTreeExpandLoaded(e).then(function(){return t.handleAsyncTreeExpandChilds(e)}),this.$nextTick()},triggerTreeExpandEvent:function(e,t){var r=this.treeOpts,o=this.treeLazyLoadeds,i=t.row,l=t.column;r.lazy&&-1!==o.indexOf(i)||(t=!this.isTreeExpandByRow(i),r=this.getColumnIndex(l),o=this.getVMColumnIndex(l),this.setTreeExpand(i,t),this.emitEvent("toggle-tree-expand",{expanded:t,column:l,columnIndex:r,$columnIndex:o,row:i},e))},toggleTreeExpand:function(e){return this.setTreeExpand(e,!this.isTreeExpandByRow(e))},handleDefaultTreeExpand:function(){var e,r,o,t=this.treeConfig,i=this.treeOpts,l=this.tableFullData;t&&(e=i.expandAll,t=i.expandRowKeys,e?this.setAllTreeExpand(!0):t&&(r=[],o=getRowkey(this),t.forEach(function(t){var e=_xeUtils.default.findTree(l,function(e){return t===_xeUtils.default.get(e,o)},i);e&&r.push(e.item)}),this.setTreeExpand(r,!0)))},handleAsyncTreeExpandChilds:function(r){var o=this,e=this.fullAllDataRowMap,i=this.treeExpandeds,t=this.treeOpts,l=this.treeLazyLoadeds,n=this.checkboxOpts,s=t.loadMethod,a=n.checkStrictly,c=e.get(r);return new Promise(function(t){l.push(r),s({$table:o,row:r}).catch(function(){return[]}).then(function(e){c.treeLoaded=!0,_xeUtils.default.remove(l,function(e){return e===r}),(e=!_xeUtils.default.isArray(e)?[]:e)&&o.loadChildren(r,e).then(function(e){e.length&&-1===i.indexOf(r)&&i.push(r),!a&&o.isCheckedByCheckboxRow(r)&&o.setCheckboxRow(e,!0)}),t(o.$nextTick().then(o.recalculate))})})},setAllTreeExpand:function(e){var t=this.tableFullData,r=this.treeOpts,o=r.lazy,i=r.children,l=[];return _xeUtils.default.eachTree(t,function(e){var t=e[i];(o||t&&t.length)&&l.push(e)},r),this.setTreeExpand(l,e)},setTreeExpand:function(e,t){var r=this,o=this.fullAllDataRowMap,i=this.tableFullData,l=this.treeExpandeds,n=this.treeOpts,s=this.treeLazyLoadeds,a=this.treeNodeColumn,c=n.reserve,u=n.lazy,h=n.hasChild,d=n.children,f=n.accordion,g=n.toggleMethod,x=[],v=this.getColumnIndex(a),p=this.getVMColumnIndex(a);if(e&&(e=!_xeUtils.default.isArray(e)?[e]:e).length){var m,w=g?e.filter(function(e){return g({expanded:t,column:a,columnIndex:v,$columnIndex:p,row:e})}):e;return f&&(w=w.length?[w[w.length-1]]:[],(m=_xeUtils.default.findTree(i,function(e){return e===w[0]},n))&&_xeUtils.default.remove(l,function(e){return-1<m.items.indexOf(e)})),t?w.forEach(function(e){var t;-1===l.indexOf(e)&&(t=o.get(e),u&&e[h]&&!t.treeLoaded&&-1===s.indexOf(e)?x.push(r.handleAsyncTreeExpandChilds(e)):e[d]&&e[d].length&&l.push(e))}):_xeUtils.default.remove(l,function(e){return-1<w.indexOf(e)}),c&&w.forEach(function(e){return r.handleTreeExpandReserve(e,t)}),Promise.all(x).then(this.recalculate)}return this.$nextTick()},isTreeExpandByRow:function(e){return-1<this.treeExpandeds.indexOf(e)},clearTreeExpand:function(){var t=this,e=this.treeOpts,r=this.treeExpandeds,o=this.tableFullData,i=e.reserve,l=r.length;return this.treeExpandeds=[],i&&_xeUtils.default.eachTree(o,function(e){return t.handleTreeExpandReserve(e,!1)},e),this.$nextTick().then(function(){l&&t.recalculate()})},clearTreeExpandReserve:function(){return this.treeExpandedReserveRowMap={},this.$nextTick()},handleTreeExpandReserve:function(e,t){var r,o=this.treeExpandedReserveRowMap;this.treeOpts.reserve&&(r=getRowid(this,e),t?o[r]=e:o[r]&&delete o[r])},getScroll:function(){var e=this.$refs,t=this.scrollXLoad,r=this.scrollYLoad,e=e.tableBody.$el;return{virtualX:t,virtualY:r,scrollTop:e.scrollTop,scrollLeft:e.scrollLeft}},triggerScrollXEvent:function(){this.loadScrollXData()},loadScrollXData:function(){var e=this.mergeList,t=this.mergeFooterList,r=this.scrollXStore,o=r.startIndex,i=r.endIndex,l=r.offsetSize,n=computeVirtualX(this),s=n.toVisibleIndex,n=n.visibleSize,l={startIndex:Math.max(0,s-1-l),endIndex:s+n+l};calculateMergerOffserIndex(e.concat(t),l,"col");t=l.startIndex,l=l.endIndex;(s<=o||i-n-1<=s)&&(o===t&&i===l||(r.startIndex=t,r.endIndex=l,this.updateScrollXData())),this.closeTooltip()},triggerScrollYEvent:function(e){var t=this.scrollYStore,r=t.adaptive,o=t.offsetSize,t=t.visibleSize;isWebkit&&r&&2*o+t<=40?this.loadScrollYData(e):this.debounceScrollY(e)},debounceScrollY:_xeUtils.default.debounce(function(e){this.loadScrollYData(e)},debounceScrollYDuration,{leading:!1,trailing:!0}),loadScrollYData:function(e){var t=this.mergeList,r=this.scrollYStore,o=r.startIndex,i=r.endIndex,l=r.visibleSize,n=r.offsetSize,s=r.rowHeight,e=(e.currentTarget||e.target).scrollTop,s=Math.floor(e/s),n={startIndex:Math.max(0,s-1-n),endIndex:s+l+n};calculateMergerOffserIndex(t,n,"row");t=n.startIndex,n=n.endIndex;(s<=o||i-l-1<=s)&&(o===t&&i===n||(r.startIndex=t,r.endIndex=n,this.updateScrollYData()))},computeScrollLoad:function(){var s=this;return this.$nextTick().then(function(){var e=s.sYOpts,t=s.sXOpts,r=s.scrollXLoad,o=s.scrollYLoad,i=s.scrollXStore,l=s.scrollYStore;r?(r=computeVirtualX(s).visibleSize,n=t.oSize?_xeUtils.default.toNumber(t.oSize):_dom.browse.msie?10:_dom.browse.edge?5:0,i.offsetSize=n,i.visibleSize=r,i.endIndex=Math.max(i.startIndex+i.visibleSize+n,i.endIndex),s.updateScrollXData()):s.updateScrollXSpace();var n=computeVirtualY(s),i=n.rowHeight,n=n.visibleSize;l.rowHeight=i,o?(e=e.oSize?_xeUtils.default.toNumber(e.oSize):_dom.browse.msie?20:_dom.browse.edge?10:0,l.offsetSize=e,l.visibleSize=n,l.endIndex=Math.max(l.startIndex+n+e,l.endIndex),s.updateScrollYData()):s.updateScrollYSpace(),s.rowHeight=i,s.$nextTick(s.updateStyle)})},handleTableColumn:function(){var e=this.scrollXLoad,t=this.visibleColumn,r=this.scrollXStore;this.tableColumn=e?t.slice(r.startIndex,r.endIndex):t.slice(0)},updateScrollXData:function(){this.handleTableColumn(),this.updateScrollXSpace()},updateScrollXSpace:function(){var e=this.$refs,o=this.elemStore,t=this.visibleColumn,r=this.scrollXStore,i=this.scrollXLoad,l=this.tableWidth,n=this.scrollbarWidth,s=e.tableHeader,a=e.tableBody,e=e.tableFooter,a=a?a.$el:null;a&&(s=s?s.$el:null,e=e?e.$el:null,s=s?s.querySelector(".vxe-table--header"):null,a=a.querySelector(".vxe-table--body"),e=e?e.querySelector(".vxe-table--footer"):null,t=t.slice(0,r.startIndex).reduce(function(e,t){return e+t.renderWidth},0),r="",i&&(r="".concat(t,"px")),s&&(s.style.marginLeft=r),a.style.marginLeft=r,e&&(e.style.marginLeft=r),["main"].forEach(function(r){["header","body","footer"].forEach(function(e){var t=o["".concat(r,"-").concat(e,"-xSpace")];t&&(t.style.width=i?"".concat(l+("header"===e?n:0),"px"):"")})}),this.$nextTick(this.updateStyle))},updateScrollYData:function(){this.handleTableData(),this.updateScrollYSpace()},updateScrollYSpace:function(){var r=this.elemStore,e=this.scrollYStore,t=this.scrollYLoad,o=this.afterFullData,i=e.startIndex,e=e.rowHeight,o=o.length*e,e=Math.max(0,i*e),l="",n="";t&&(l="".concat(e,"px"),n="".concat(o,"px")),["main","left","right"].forEach(function(t){var e=r["".concat(t,"-body-table")];e&&(e.style.marginTop=l),["header","body","footer"].forEach(function(e){e=r["".concat(t,"-").concat(e,"-ySpace")];e&&(e.style.height=n)})}),this.$nextTick(this.updateStyle)},scrollTo:function(e,t){var r=this,o=this.$refs,i=o.tableBody,l=o.rightBody,o=o.tableFooter,i=i?i.$el:null,l=l?l.$el:null,o=o?o.$el:null;return _xeUtils.default.isNumber(e)&&(0,_dom.setScrollLeft)(o||i,e),_xeUtils.default.isNumber(t)&&(0,_dom.setScrollTop)(l||i,t),this.scrollXLoad||this.scrollYLoad?new Promise(function(e){return setTimeout(function(){return e(r.$nextTick())},50)}):this.$nextTick()},scrollToRow:function(e,t){var r=[];return e&&(this.treeConfig?r.push(this.scrollToTreeRow(e)):r.push(_tools.DomTools.rowToVisible(this,e))),t&&r.push(this.scrollToColumn(t)),Promise.all(r)},scrollToColumn:function(e){e=(0,_util.handleFieldOrColumn)(this,e);return e&&this.fullColumnMap.has(e)?_tools.DomTools.colToVisible(this,e):this.$nextTick()},scrollToTreeRow:function(t){var r,o=this,e=this.tableFullData,i=this.treeConfig,l=this.treeOpts;return!i||(l=_xeUtils.default.findTree(e,function(e){return e===t},l))&&(r=l.nodes).forEach(function(e,t){t<r.length-1&&!o.isTreeExpandByRow(e)&&o.setTreeExpand(e,!0)}),this.$nextTick()},clearScroll:function(){var e=this.$refs,t=e.tableBody,r=e.rightBody,e=e.tableFooter,t=t?t.$el:null,r=r?r.$el:null,e=e?e.$el:null;return r&&(r.scrollTop=0),e&&(e.scrollLeft=0),t&&(t.scrollTop=0,t.scrollLeft=0),this.$nextTick()},updateFooter:function(){var e=this.showFooter,t=this.visibleColumn,r=this.footerMethod;return e&&r&&(this.footerTableData=t.length?r({columns:t,data:this.afterFullData,$table:this,$grid:this.$xegrid}):[]),this.$nextTick()},updateStatus:function(n,s){var a=this,c=!_xeUtils.default.isUndefined(s);return this.$nextTick().then(function(){var e=a.$refs,t=a.editRules,r=a.validStore;if(n&&e.tableBody&&t){var o=n.row,i=n.column;if(a.hasCellRules("change",o,i)){var l=a.getCell(o,i);if(l)return a.validCellRules("change",o,i,s).then(function(){c&&r.visible&&setCellValue(o,i,s),a.clearValidate()}).catch(function(e){e=e.rule;c&&setCellValue(o,i,s),a.showValidTooltip({rule:e,row:o,column:i,cell:l})})}}})},handleDefaultMergeCells:function(){this.setMergeCells(this.mergeCells)},setMergeCells:function(e){var t=this;return this.spanMethod&&_tools.UtilTools.error("vxe.error.errConflicts",["merge-cells","span-method"]),setMerges(this,e,this.mergeList,this.afterFullData),this.$nextTick().then(function(){return t.updateCellAreas()})},removeMergeCells:function(e){var t=this;this.spanMethod&&_tools.UtilTools.error("vxe.error.errConflicts",["merge-cells","span-method"]);var r=removeMerges(this,e,this.mergeList,this.afterFullData);return this.$nextTick().then(function(){return t.updateCellAreas(),r})},getMergeCells:function(){return this.mergeList.slice(0)},clearMergeCells:function(){return this.mergeList=[],this.$nextTick()},handleDefaultMergeFooterItems:function(){this.setMergeFooterItems(this.mergeFooterItems)},setMergeFooterItems:function(e){var t=this;return this.footerSpanMethod&&_tools.UtilTools.error("vxe.error.errConflicts",["merge-footer-items","footer-span-method"]),setMerges(this,e,this.mergeFooterList,null),this.$nextTick().then(function(){return t.updateCellAreas()})},removeMergeFooterItems:function(e){var t=this;this.footerSpanMethod&&_tools.UtilTools.error("vxe.error.errConflicts",["merge-footer-items","footer-span-method"]);var r=removeMerges(this,e,this.mergeFooterList,null);return this.$nextTick().then(function(){return t.updateCellAreas(),r})},getMergeFooterItems:function(){return this.mergeFooterList.slice(0)},clearMergeFooterItems:function(){return this.mergeFooterList=[],this.$nextTick()},updateZindex:function(){this.zIndex?this.tZindex=this.zIndex:this.tZindex<_tools.UtilTools.getLastZIndex()&&(this.tZindex=_tools.UtilTools.nextZIndex())},updateCellAreas:function(){this.mouseConfig&&this.mouseOpts.area&&this.handleUpdateCellAreas&&this.handleUpdateCellAreas()},emitEvent:function(e,t,r){this.$emit(e,Object.assign({$table:this,$grid:this.$xegrid,$event:r},t))},focus:function(){return this.isActivated=!0,this.$nextTick()},blur:function(){return this.isActivated=!1,this.$nextTick()},connect:function(e){return e&&e.syncUpdate?(e.syncUpdate({collectColumn:this.collectColumn,$table:this}),this.$toolbar=e):_tools.UtilTools.error("vxe.error.barUnableLink"),this.$nextTick()},getCell:function(e,t){var r=this.$refs,e=getRowid(this,e),r=r["".concat(t.fixed||"table","Body")]||r.tableBody;return r&&r.$el?r.$el.querySelector('.vxe-body--row[rowid="'.concat(e,'"] .').concat(t.id)):null},getCellLabel:function(e,t){var r=t.formatter,o=_tools.UtilTools.getCellValue(e,t),i=o;if(r){var l,n=this.fullAllDataRowMap,s=t.id,a=n.has(e);if(a&&(a=n.get(e),l=a.formatData,l=l||(n.get(e).formatData={}),a&&l[s]&&l[s].value===o))return l[s].label;var c,t={cellValue:o,row:e,rowIndex:this.getRowIndex(e),column:t,columnIndex:this.getColumnIndex(t)};i=_xeUtils.default.isString(r)?(c=_formats.formats.get(r))?c(t):"":_xeUtils.default.isArray(r)?(c=_formats.formats.get(r[0]))?c.apply(void 0,[t].concat(_toConsumableArray(r.slice(1)))):"":r(t),l&&(l[s]={value:o,label:i})}return i}},funcs="setFilter,clearFilter,getCheckedFilters,closeMenu,setActiveCellArea,getActiveCellArea,getCellAreas,clearCellAreas,copyCellArea,cutCellArea,pasteCellArea,getCopyCellArea,clearCopyCellArea,setCellAreas,openFind,openReplace,getSelectedCell,clearSelected,insert,insertAt,remove,removeCheckboxRow,removeRadioRow,removeCurrentRow,getRecordset,getInsertRecords,getRemoveRecords,getUpdateRecords,clearActived,getActiveRecord,isActiveByRow,setActiveRow,setActiveCell,setSelectCell,clearValidate,fullValidate,validate,openExport,openPrint,exportData,openImport,importData,saveFile,readFile,importByFile,print".split(",");funcs.forEach(function(e){Methods[e]=function(){return this["_".concat(e)]?this["_".concat(e)].apply(this,arguments):null}});var _default=Methods;exports.default=Methods;